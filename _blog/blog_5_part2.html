---
title: "Generate label footprints for Satellite Imagery: the Pythonic Way [Part 2]"
collection: blog
permalink: /blog/post_5
excerpt: 'Using Overpass python wrapper to query amenities or landmarks'
date: 2018-03-01
tags:
  - GIS
  - Satellite Imagery
  - machine learning
  - Open Street Maps
  - Python
  - API
  - geoPandas
  - gdal
  - OSM
  - Bokeh
  - geoJSON
  - Visualisation
  - data science
  - notebooks
---

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>MathJax example</title>
  <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script>
  
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

  
<style>
figure {
  text-align: center;
  font-style: italic;
  font-size: smaller;
  text-indent: 0;
  border: thin silver solid;
  margin: 0.5em;
  padding: 0.5em;
}
  
pre {
white-space: pre-wrap;
white-space: -moz-pre-wrap;
white-space: -o-pre-wrap;
word-wrap: break-word;
background-color: #eee;
border: 1px solid #999;
display: block;
padding: 20px;
}

code {
font-family: Courier, 'New Courier', monospace;
font-size: 14px;
}
 
</style>
</head>


<body>
  
<p>
  Hi there! I hope you'd enjoyed the previous part of this tutorial. If you haven't checked that out, then I recommend you
  to do so before reading this part. In the previous post we had seen what we would like to achieve using Overpass,
  OSM's web API. In this part we shall dive into wrting python code to do so. For this we will use overpy, a python wrapper
  to the Overpass API.
</p>

<h2>Things to know or to brush up</h2>

<ol>
  <li> geoPandas and gdal </li>
  <li> Basic understanding of GIS using Python. Here you can find a very detailed and wonderful tutorial</li>
  <li> Go over <a href="">overPy</a> python wrapper's documentation. Make sure to understand the syntax. In any case we will
   cover that in the tutorial. </li>
</ol>

<p>
We will cover each part step by step by going over and understaning the code. I will cover only the crux of the 
  code and its logic. You can find the code in its entirity here.
Make sure to have all the libraries installed. I am using Python 3.6, have anaconda installed on my system. I wrapped the code
to make a simple API. You can play around with that in this jupyter notebook. Let's start then!

</p>
  
  
<h2>Step 0: Import Statements</h2>

<pre class="prettyprint" linenums>
import overpy
import geopandas as gpd
from shapely.geometry import Point, Polygon, LineString
from osgeo import gdal, ogr
</pre>
  
  
<h2>Step 1: Read the geoJSON file and extract the bounds of the AOI</h2>
 
<pre class="prettyprint" linenums>
input_aoi = gpd.read_file(aoi)

bounds_coords = input_aoi['geometry'].bounds

south = bounds_coords['miny'][0]
west = bounds_coords['minx'][0]
north = bounds_coords['maxy'][0]
east = bounds_coords['maxx'][0]
</pre>

  
<p>
We are given a geoJSON file (with the AOI) as an input. Remember from the last post that we had the bounding box coordinates saved as
a geoJSON file. You can use this file here. We will then read this file using the geoPandas library. <br />
In line 3 we then find the bounds of the four coordinates. This will help us to find the four coordinates.<br />
Lines 4-7 does exactly that. We save this in four different variables.<br />
</p>
  
  
  
  
<h2>Step 2: Query the OverPass API using the overpy wrapper</h2>

<pre class="prettyprint" linenums>
api = overpy.Overpass()

query_str = '[out:json];way({south:.8f}, {west:.8f}, {north:.8f},
                          {east:.8f})[{query_landmark:.50s}]; (._;>;); out;'

query_aoi = query_str.format(north=north, south=south, east=east, west=west, query_landmark='building')
</pre>
  
  
<p>
First and foremost we initialise an object of the Overpy API. <br />
In line 3 we write a query in the format prescribed by Overpy. The query string accepts the four coordinates of the
bounding box which we have already estimated in the previous step. As the fifth argument, the landmark that we are interested in
is provided. Here, <b>building</b> Take your own time to understand the syntax here. It took
to me quite soemtime to wrap my head around it. </br>
In line 6 the arguments are passed using <b>format</b>.</br>
Now, we have queried the Overpass API using the overpy wrapper to get all the buildings in the AOI. <b>query_aoi</b> stores the
query.
</p>
  
  

  
           

<h2>Credits and References</h2>
<ol>
The code was written during my internship. I should give credits to Planet and all the other cool open source projects and
libraries/APIs that were used to make this possible. If you feel that I have missed some credits, feel free to email me and
I will make sure they appear here.
</ol> 


  
</body>
</html>
